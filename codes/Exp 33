#include <stdio.h>
#include <stdint.h>

uint32_t feistel(uint32_t r, uint32_t k) {
    uint32_t expanded = r ^ k;
    uint32_t substituted = (expanded << 3) | (expanded >> 29);
    return substituted;
}

uint64_t des_encrypt(uint64_t block, uint64_t key) {
    uint32_t L = block >> 32;
    uint32_t R = block & 0xFFFFFFFF;

    for (int i = 0; i < 16; i++) {
        uint32_t temp = R;
        R = L ^ feistel(R, key + i);
        L = temp;
    }

    return ((uint64_t)R << 32) | L;
}

uint64_t des_decrypt(uint64_t block, uint64_t key) {
    uint32_t L = block >> 32;
    uint32_t R = block & 0xFFFFFFFF;

    for (int i = 15; i >= 0; i--) {
        uint32_t temp = L;
        L = R ^ feistel(L, key + i);
        R = temp;
    }

    return ((uint64_t)L << 32) | R;
}

int main() {
    uint64_t plaintext = 0x0123456789ABCDEF;
    uint64_t key = 0x133457799BBCDFF1;

    uint64_t cipher = des_encrypt(plaintext, key);
    uint64_t recovered = des_decrypt(cipher, key);

    return 0;
}
